[tasks."codegen:protobuf"]
description = "Generate protobuf code"
run = "protoc --go_out=. --go-grpc_out=. internal/proto/ci.proto"

[tasks."codegen:sqlc"]
description = "Generate sqlc code"
run = "sqlc generate"

[tasks.codegen]
description = "Generate all code"
depends = ["codegen:protobuf", "codegen:sqlc"]

[tasks.build]
description = "Build binary"
run = "go build -o bin/mise-ci ./cmd/mise-ci"

[tasks.ci]
description = "Run CI checks"
depends = ["ci:lint", "ci:test"]

[tasks."ci:lint"]
run = "golangci-lint run"

[tasks."ci:test"]
run = "go test ./..."

[tools]
"github:sqlc-dev/sqlc" = "1.30.0"
go = "1.25.5"
"go:golang.org/x/tools/gopls" = "latest"
golangci-lint = "2.8.0"
protoc = "33.2"
protoc-gen-go = "1.36.11"
protoc-gen-go-grpc = "1.6.0"
